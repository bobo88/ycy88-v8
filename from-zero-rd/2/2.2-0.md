# 2.2 中间件设计与使用

> 中间件的核心思想是为应用的各个阶段和层次提供一种可插拔的、可扩展的机制。

::: tip 提示
“没有任何两个 **应用组件** 是无法通过一个 **中间件** 连接的，如果不行，那就再加一个。”
:::

## **1. 中间件的设计原则**

- **单一职责**：每个中间件应该有一个单一的功能，不要让一个中间件承担过多的责任。
- **顺序性**：中间件的顺序非常重要，确保中间件的顺序能正确处理请求和响应。
- **可重用性**：中间件应该具有一定的通用性，可以在多个应用或路由中复用。
- **可测试性**：中间件应易于单元测试和集成测试，能够独立测试其功能。
- **错误处理**：通过错误处理中间件集中处理错误，避免重复的错误处理逻辑。

## **2. 中间件的使用**

- **全局中间件**：在应用启动时注册的中间件，对所有路由和请求都生效。
- **路由中间件**：在特定路由上注册的中间件，只对匹配的路由生效。
- **错误处理中间件**：专门用于处理错误，可以捕获和处理应用中的错误。

## **3. 中间件的实现**

- **中间件函数**：中间件函数是一个接受 `next` 函数作为参数的函数，用于处理请求和响应。
  > TODO
