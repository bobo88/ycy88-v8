# 移动端如何性能优化？

移动端性能优化是确保移动用户获得流畅、高效体验的关键。

::: tip 关键词
优化资源请求（缓存很重要！）、优化图像、优化 CSS 和 JavaScript、提升首屏加载速度、提高运行时性能、网络优化、使用性能监控工具。
:::

## 1. 减少资源请求数量和大小

- **合并文件**：将多个 CSS 和 JavaScript 文件合并为一个文件，减少 HTTP 请求数量。
- **压缩资源**：使用 Gzip 或 Brotli 压缩 HTML、CSS 和 JavaScript 文件。
- **使用 CDN**：将静态资源托管在内容分发网络（CDN）上，减少请求延迟。

## 2. 优化图像

- **适应屏幕尺寸**：根据设备的屏幕尺寸加载适当分辨率的图像。
- **使用现代图像格式**：使用 WebP 或 AVIF 格式的图像，提供更好的压缩率和质量。
- **延迟加载（Lazy Loading）**：只在需要时加载图像，减少初始加载时间。

## 3. 优化 CSS 和 JavaScript

- **压缩和混淆代码**：压缩和混淆 CSS 和 JavaScript 文件，减少文件大小。
- **代码分割**：将 JavaScript 代码按需分割，使用动态导入（dynamic import）按需加载。
- **异步加载**：使用`async`或`defer`属性异步加载非关键 JavaScript 文件。

## 4. 提升首屏加载速度

- **关键 CSS 内联**：将关键 CSS 内联在 HTML 中，确保页面首屏内容尽快渲染。
- **预加载重要资源**：使用`<link rel="preload">`预加载关键资源，如字体和大图片。
- **减少重定向**：避免重定向链，直接加载目标页面。

## 5. 提高运行时性能

- **避免阻塞主线程**：将繁重的 JavaScript 任务移到 Web Worker 中，避免阻塞 UI 线程。
- **减少重排和重绘**：尽量减少和优化 DOM 操作，避免频繁的重排和重绘。
- **优化动画性能**：使用 CSS3 硬件加速属性，如`transform`和`opacity`，优化动画性能。

## 6. 网络优化

- **使用 HTTP/2**：启用 HTTP/2 以提高多路复用和头部压缩，提升请求性能。
- **离线支持**：使用 Service Worker 实现离线缓存，提升用户体验和可靠性。
- **减少 DNS 查找**：优化 DNS 查找时间，预先解析常用域名。

## 7. 使用性能监控工具

- **Lighthouse**：使用 Google 的 Lighthouse 工具进行性能审计，获取具体的优化建议。
- **WebPageTest**：测试网站在不同网络条件下的性能，识别瓶颈。
- **Chrome DevTools**：使用 Chrome DevTools 分析网络请求、性能瓶颈和渲染时间。

## 8. 优化内存和电量消耗

- **减少内存泄漏**：定期清理不再需要的对象和事件监听器，避免内存泄漏。
- **减少电量消耗**：优化动画和定时器的使用，减少对 CPU 和 GPU 的频繁调用。

## 示例分析

以移动端性能优化为例，假设有一个电子商务网站在移动设备上表现不佳：

1. **减少资源请求数量和大小**

   - 合并多个 CSS 文件为一个`styles.min.css`，合并多个 JavaScript 文件为一个`scripts.min.js`。
   - 使用 Gzip 压缩`styles.min.css`和`scripts.min.js`，减少文件大小。

2. **优化图像**

   - 根据设备的屏幕尺寸加载适当分辨率的图像，例如使用`srcset`属性。
   - 将 JPEG 图像转换为 WebP 格式，并通过 Lazy Loading 技术加载图像。

3. **优化 CSS 和 JavaScript**

   - 使用工具如 Terser 和 CSSNano 压缩和混淆 JavaScript 和 CSS 文件。
   - 将 JavaScript 代码按需分割，使用 Webpack 的动态导入功能，按需加载。

4. **提升首屏加载速度**

   - 将关键 CSS 内联在 HTML 中，确保页面首屏内容尽快渲染。
   - 通过`<link rel="preload">`预加载字体和大图片。

5. **提高运行时性能**

   - 将复杂的计算任务移到 Web Worker 中，避免阻塞主线程。
   - 使用 CSS3 硬件加速属性，如`transform`和`opacity`，优化动画性能。

6. **网络优化**

   - 启用 HTTP/2，以提高请求性能。
   - 使用 Service Worker 实现离线缓存，提升用户体验和可靠性。

7. **使用性能监控工具**

   - 使用 Lighthouse 工具进行性能审计，获取具体的优化建议。
   - 使用 WebPageTest 测试网站在不同网络条件下的性能，识别瓶颈。

8. **优化内存和电量消耗**
   - 定期清理不再需要的对象和事件监听器，避免内存泄漏。
   - 优化动画和定时器的使用，减少对 CPU 和 GPU 的频繁调用。
