import { defineConfig } from "vitepress";
import { nav, sidebar } from "./data/index";
import path from "path";
import seoPlugin from "./utils/seo-plugin";
import { withPwa } from "@vite-pwa/vitepress";
// import VitePWA from "vite-plugin-pwa";

export default withPwa(
  defineConfig({
    title: "V8程序",
    description: "V8程序",
    head: [
      ["meta", { name: "og:type", content: "article" }],
      ["meta", { name: "description", content: "" }],
      [
        "meta",
        {
          name: "keywords",
          content: "程序员，思考，全栈开发，前端，后端，博客文档，技术博客",
        },
      ],
      [
        "meta",
        {
          name: "og:image",
          content: "https://fe.ycy88.com/images/think/work.png",
        },
      ],

      [
        "script",
        {
          type: "text/javascript",
          src: "https://www.googletagmanager.com/gtag/js?id=G-HM7Z052JF1",
          async: true,
        },
      ],
      // 添加谷歌标签管理器代码到头部
      [
        "script",
        {},
        `
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
      
        gtag('config', 'G-HM7Z052JF1');
        `,
      ],
    ],
    themeConfig: {
      search: {
        provider: "local",
      },

      // 配置文件引入
      nav,
      sidebar,

      outlineTitle: "💖当前页面目录💖",
      docFooter: {
        prev: "上一篇",
        next: "下一篇",
      },
      lastUpdatedText: "最近更新时间",

      socialLinks: [
        { icon: "github", link: "https://github.com/bobo88/ycy88-v8" },
        {
          icon: {
            svg: '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1711598656449" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2360" xmlns:xlink="http://www.w3.org/1999/xlink" width="256" height="256"><path d="M512 0c-283.569231 0-512 228.430769-512 512s228.430769 512 512 512 512-228.430769 512-512-228.430769-512-512-512z m0 992.492308c-263.876923 0-480.492308-216.615385-480.492308-480.492308s216.615385-480.492308 480.492308-480.492308 480.492308 216.615385 480.492308 480.492308-216.615385 480.492308-480.492308 480.492308z" fill="#1296db" p-id="2361"></path><path d="M236.307692 701.046154v-417.476923h157.538462c31.507692 0 59.076923 3.938462 78.769231 11.815384 19.692308 7.876923 35.446154 19.692308 47.261538 39.384616s15.753846 35.446154 15.753846 55.138461-3.938462 35.446154-15.753846 51.2-23.630769 27.569231-43.323077 39.384616c23.630769 7.876923 43.323077 19.692308 59.076923 39.384615 11.815385 19.692308 19.692308 39.384615 19.692308 63.015385 0 19.692308-3.938462 39.384615-11.815385 55.138461-7.876923 15.753846-19.692308 31.507692-31.507692 39.384616s-27.569231 15.753846-47.261538 19.692307-39.384615 7.876923-66.953847 7.876923h-161.476923v-3.938461z m55.138462-244.184616h90.584615c23.630769 0 43.323077 0 51.2-3.938461 15.753846-3.938462 23.630769-11.815385 31.507693-19.692308 7.876923-7.876923 11.815385-23.630769 11.815384-35.446154 0-15.753846-3.938462-27.569231-11.815384-35.446153-7.876923-11.815385-15.753846-19.692308-27.569231-23.63077-11.815385-3.938462-35.446154-3.938462-63.015385-3.938461h-82.707692v122.092307z m0 192.984616h102.4c19.692308 0 31.507692 0 39.384615-3.938462 11.815385-3.938462 23.630769-7.876923 31.507693-11.815384 7.876923-3.938462 15.753846-11.815385 19.692307-23.63077s7.876923-23.630769 7.876923-35.446153c0-15.753846-3.938462-27.569231-11.815384-39.384616-7.876923-11.815385-19.692308-19.692308-31.507693-23.630769-15.753846-3.938462-35.446154-7.876923-63.015384-7.876923h-98.461539v145.723077h3.938462zM622.276923 815.261538l-3.938461-47.261538c11.815385 3.938462 19.692308 3.938462 27.56923 3.938462 11.815385 0 19.692308 0 27.569231-3.938462s11.815385-7.876923 15.753846-15.753846c3.938462-3.938462 7.876923-19.692308 15.753846-39.384616 0-3.938462 3.938462-7.876923 3.938462-11.815384l-114.215385-303.261539h55.138462l63.015384 177.23077 23.63077 70.892307c7.876923-23.630769 11.815385-47.261538 19.692307-70.892307l63.015385-177.23077h51.2l-114.215385 307.2c-11.815385 31.507692-23.630769 55.138462-27.56923 66.953847-7.876923 15.753846-19.692308 27.569231-31.507693 35.446153-11.815385 7.876923-27.569231 11.815385-43.323077 11.815385-7.876923 3.938462-19.692308 3.938462-31.507692-3.938462z" fill="#1296db" p-id="2362"></path></svg>',
          },
          link: "http://ycy88.com",
        },
        {
          icon: {
            svg: '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1711598748843" class="icon" viewBox="0 0 1562 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3575" xmlns:xlink="http://www.w3.org/1999/xlink" width="390.5" height="256"><path d="M638.976 539.378526L646.736842 523.856842l75.021474-2.586947c26.731789-52.601263 57.559579-97.872842 92.483368-135.814737a592.141474 592.141474 0 0 1 115.765895-97.657263A727.309474 727.309474 0 0 1 1067.115789 219.243789c49.152-18.539789 101.322105-34.708211 156.510316-48.505263V168.151579c-25.869474 0-52.170105-0.431158-78.901894-1.293474A23252.345263 23252.345263 0 0 0 961.050947 161.684211a4862.760421 4862.760421 0 0 0-117.706105-1.293474c-53.463579 0-108.220632 1.509053-164.271158 4.527158-56.050526 3.018105-110.592 8.623158-163.624421 16.815158s-103.262316 19.186526-150.689684 32.983579c-47.427368 13.797053-88.602947 31.258947-123.526737 52.385684-34.923789 21.126737-62.733474 46.133895-83.429053 75.021473-20.695579 28.887579-31.043368 63.164632-31.043368 102.831158 0 28.456421 6.467368 52.385684 19.402105 71.78779 12.934737 19.402105 29.103158 34.923789 48.505263 46.565052 19.402105 11.641263 40.96 19.833263 64.673685 24.576 23.713684 4.742737 46.349474 7.114105 67.907368 7.114106 30.181053 0 63.595789-4.742737 100.244211-14.228211a428.624842 428.624842 0 0 0 104.124631-42.037895A275.348211 275.348211 0 0 0 613.753263 468.884211c21.989053-28.025263 32.983579-60.146526 32.983579-96.36379 0-17.246316-1.509053-34.061474-4.527158-50.445474a212.075789 212.075789 0 0 0-14.874947-47.858526l11.641263-6.467368c4.311579 7.760842 9.269895 20.48 14.874947 38.157473 5.605053 17.677474 8.407579 41.606737 8.407579 71.78779 0 43.115789-10.132211 82.351158-30.396631 117.706105a305.367579 305.367579 0 0 1-78.901895 90.543158c-32.336842 25.007158-68.338526 44.409263-108.005053 58.206316a356.621474 356.621474 0 0 1-117.706105 20.695579c-25.869474 0-51.738947-4.742737-77.608421-14.228211a236.490105 236.490105 0 0 1-71.141053-41.391158 210.189474 210.189474 0 0 1-52.385684-66.613894c-13.365895-26.300632-20.048842-56.266105-20.048842-89.896422 0-57.775158 15.521684-108.220632 46.565053-151.336421 31.043368-43.115789 71.572211-79.979789 121.586526-110.592 50.014316-30.612211 106.711579-56.050526 170.09179-76.314947a1515.196632 1515.196632 0 0 1 191.434105-47.858526 1749.638737 1749.638737 0 0 1 186.26021-23.929263c59.930947-4.311579 111.023158-6.467368 153.276632-6.467369 60.362105 0 114.256842 0.431158 161.68421 1.293474a7904.741053 7904.741053 0 0 1 227.651369 7.114105 1832.421053 1832.421053 0 0 0 80.195368 1.940211c9.485474 0 20.264421 1.077895 32.336842 3.233684 12.072421 2.155789 23.282526 5.820632 33.630316 10.994526 10.347789 5.173895 19.186526 11.856842 26.516211 20.048842s10.994526 18.324211 10.994526 30.396632c0 16.384-5.605053 29.534316-16.815158 39.450947-11.210105 9.916632-25.007158 17.246316-41.391158 21.989053a247.484632 247.484632 0 0 1-50.445473 9.054316c-17.246316 1.293474-31.905684 1.940211-43.978106 1.94021-9.485474 0-20.264421-0.431158-32.336842-1.293474l-36.217263-2.586947a4042.967579 4042.967579 0 0 1-34.277053-2.586947 345.303579 345.303579 0 0 0-26.51621-1.293474c-39.666526 0-77.608421 12.072421-113.825684 36.217263a523.964632 523.964632 0 0 0-100.890948 88.602948 791.929263 791.929263 0 0 0-82.782316 111.238736 3784.865684 3784.865684 0 0 0-62.086736 104.124632c27.594105-2.586947 51.092211-6.036211 70.494315-10.347789 19.402105-4.311579 33.845895-9.485474 43.331369-15.521685a48.074105 48.074105 0 0 0 13.581474-14.22821c4.742737-6.898526 9.701053-14.228211 14.874947-21.989053 5.173895-7.760842 10.563368-14.659368 16.168421-20.695579 5.605053-6.036211 11.425684-9.054316 17.461895-9.054316h142.282105a1650.903579 1650.903579 0 0 0-160.390737 150.042948 1194.469053 1194.469053 0 0 0-134.521263 173.325473l-11.641263 1.293474c7.760842-39.666526 19.833263-78.039579 36.217263-115.119158 16.384-37.079579 33.199158-74.159158 50.445474-111.238737-12.072421 0-28.240842 1.724632-48.505264 5.173895a479.986526 479.986526 0 0 1-56.266105 6.467369 1266.849684 1266.849684 0 0 1-111.238737 181.733052 710.063158 710.063158 0 0 1-137.10821 140.988632c-50.876632 39.235368-107.789474 69.632-170.738526 91.189895-62.949053 21.557895-133.658947 32.336842-212.129685 32.336842-25.869474 0-52.816842-2.802526-80.842105-8.407579a263.976421 263.976421 0 0 1-76.961684-27.809685 172.894316 172.894316 0 0 1-57.559579-51.09221c-15.090526-21.126737-22.635789-47.211789-22.63579-78.255158 0-12.934737 2.586947-25.222737 7.760843-36.864 5.173895-11.641263 11.856842-21.989053 20.048842-31.043368 8.192-9.054316 18.108632-16.384 29.749894-21.989053 11.641263-5.605053 23.929263-8.407579 36.864-8.407579 22.420211 0 41.606737 6.682947 57.559579 20.048842 15.952842 13.365895 23.929263 31.690105 23.929263 54.972632 0 19.833263-4.958316 36.648421-14.874947 50.445473a81.92 81.92 0 0 1-42.037895 29.749895c5.173895 35.354947 19.617684 59.715368 43.331369 73.081263 23.713684 13.365895 51.954526 20.048842 84.722526 20.048842 58.637474 0 109.298526-14.659368 151.983158-43.978105a502.352842 502.352842 0 0 0 113.825684-108.651789c33.199158-43.115789 63.164632-89.465263 89.896421-139.048421 26.731789-49.583158 53.032421-95.070316 78.901895-136.461474l-73.728 2.586947z" p-id="3576" fill="#faa0ca"></path></svg>',
            // svg: '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1711597229827" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5223" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M0 146.724571C0 65.682286 65.609143 0 146.724571 0h730.550858C958.317714 0 1024 65.609143 1024 146.724571v730.550858A146.724571 146.724571 0 0 1 877.275429 1024H146.724571A146.797714 146.797714 0 0 1 0 877.275429V146.724571zM219.428571 219.428571l32.475429 32.475429 32.548571 32.548571 32.475429 32.475429v357.668571L219.428571 772.022857V804.571429h520.118858L804.571429 577.024l-32.475429 32.475429-32.548571 32.548571-32.475429 32.475429H446.902857V316.928l32.548572-32.475429L512 251.904 544.475429 219.428571H219.428571z" fill="#0ba5f6" p-id="5224"></path></svg>'
          },
          link: "https://docs.ycy88.com",
        },
      ],
    },
    markdown: {
      // plugins: ['task-lists'],
      lineNumbers: true,
      linkify: false, // 禁用链接的自动转换
    },
    lastUpdated: true,
    cleanUrls: true,
    vite: {
      plugins: [
        {
          name: "vitepress-ignore-dead-links",
          enforce: "pre",
          config() {
            // 忽略死链接警告
            return {
              resolve: {
                alias: {
                  // 配置忽略的文件
                  "README.md": "./README.md",
                  // 添加一些修复死链接的配置
                },
              },
            };
          },
        },
      ],
      resolve: {
        alias: [
          {
            find: "@",
            replacement: path.resolve(__dirname, ".vitepress"),
          },
        ],
      },
    },
    // PWA 配置
    pwa: {
      // @ts-ignore
      // registerType: "autoUpdate", // 自动更新 Service Worker
      registerType: "prompt", // 手动触发更新
      manifest: {
        name: "V8程序",
        short_name: "V8",
        description: "这是一个 VitePress 博客文档网站",
        theme_color: "#ffffff",
        icons: [
          {
            src: "/pwa-192x192.png",
            sizes: "192x192",
            type: "image/png",
          },
          {
            src: "/pwa-512x512.png",
            sizes: "512x512",
            type: "image/png",
          },
        ],
      },
      workbox: {
        maximumFileSizeToCacheInBytes: 8 * 1024 * 1024, // 允许最大文件大小为 6 MiB
        // Workbox 选项 (可选)
        runtimeCaching: [
          {
            urlPattern: /\.(?:png|jpg|jpeg|svg|gif|webp|avif|ico)$/,
            handler: "CacheFirst",
            options: {
              cacheName: "images",
              expiration: {
                maxEntries: 50,
                maxAgeSeconds: 30 * 24 * 60 * 60, // 30 天
              },
            },
          },
        ],
      },
    },
    plugins: [
      // VitePWA({
      //   // @ts-ignore
      //   registerType: "autoUpdate", // 自动更新 Service Worker
      //   manifest: {
      //     name: "V8程序",
      //     short_name: "V8",
      //     description: "这是一个 VitePress 博客文档网站",
      //     theme_color: "#ffffff",
      //     start_url: ".", // 设置启动 URL
      //     display: "standalone",
      //     background_color: "#ffffff",
      //     icons: [
      //       {
      //         src: "/pwa-192x192.png",
      //         sizes: "192x192",
      //         type: "image/png",
      //       },
      //       {
      //         src: "/pwa-512x512.png",
      //         sizes: "512x512",
      //         type: "image/png",
      //       },
      //     ],
      //   },
      // }),
    ],
    // plugins: [seoPlugin]
  })
);
